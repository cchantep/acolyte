<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-05-01 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140501" />
    <meta http-equiv="Content-Language" content="en" />
    <title>acolyte - Acolyte Scalac plugin</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="css/pygments.min.css"/>
                      
        
<link rel="stylesheet" type="text/css" href="css/responsive.css"/>
          
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/cchantep/acolyte">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Acolyte</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-05-01
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0.18
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">User guide</li>
                              
      <li>
  
                          <a href="./index.html#Java" title="Java">
          <i class="none"></i>
        Java</a>
            </li>
                
      <li>
  
                          <a href="./index.html#Scala" title="Scala">
          <i class="none"></i>
        Scala</a>
            </li>
                
      <li>
  
                          <a href="./index.html#Play_Framework" title="Play Framework">
          <i class="none"></i>
        Play Framework</a>
            </li>
                
      <li>
  
                          <a href="./faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Subprojects</li>
                              
      <li>
  
                          <a href="./studio.html" title="Acolyte Studio">
          <i class="none"></i>
        Acolyte Studio</a>
            </li>
                
      <li>
  
                          <a href="./scalac-plugin.html" title="Scalac plugin">
          <i class="none"></i>
        Scalac plugin</a>
            </li>
                              <li class="nav-header">Reference</li>
                              
      <li>
  
                          <a href="./javadocs/index.html" title="Javadoc">
          <i class="none"></i>
        Javadoc</a>
            </li>
                
      <li>
  
                          <a href="./scaladocs/index.html" title="Scaladoc">
          <i class="none"></i>
        Scaladoc</a>
            </li>
                
      <li>
  
                          <a href="./changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                              <li class="nav-header">Tutorials</li>
                              
      <li>
  
                          <a href="https://github.com/cchantep/acolyte/tree/10m-anorm-tutorial#acolyteanorm-10-minutes-tutorial" class="externalLink" title="10m with Anorm">
          <i class="none"></i>
        10m with Anorm</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                    
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/cchantep" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow cchantep</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Acolyte Scalac plugin</h1>
<p>Scala compiler plugin</p>
<div class="section">
<h2>Match component<a name="Match_component"></a></h2>
<p>Scala pattern matching involves use of either case class or extractor.</p>
<p>When extractor needs parameters to be created, it should be declared as stable identifier before <tt>match</tt> block. e.g. With regular expression matching:</p>

<div>
<pre>val Letter = &quot;[a-zA-Z]+&quot;.r

&quot;String&quot; match {
  case Letter &#x21d2; true
}
</pre></div>
<p>Match component included in this plugin provides syntax <tt>~(extractorFactory[, bindings])</tt> for rich pattern matching.</p>
<p>Consider following extractor, instantiated with one parameter:</p>

<div>
<pre>case class Regex(e: String) {
  lazy val re = e.r
  def unapplySeq(target: Any): Option[List[String]] = re.unapplySeq(target)
}
</pre></div>
<p>Then provided rich syntax can be used as following (see <a href="./src/test/scala/acolyte/ExtractorComponentSpec.scala#L189">complete example</a>):</p>

<div>
<pre>str match {
  case ~(Regex(&quot;^a.*&quot;))                      &#x21d2; 1 // no binding

  case ~(Regex(&quot;# ([A-Z]+).*&quot;), a)           &#x21d2; 2 
  // if str == &quot;# BCD123&quot;, then a = &quot;BCD&quot;

  case ~(Regex(&quot;([0-9]+);([a-z]+)&quot;), (a, b)) &#x21d2; 3
  // if str == &quot;234;xyz&quot;, then a = &quot;234&quot; and b = &quot;xyz&quot;

  case _                                     &#x21d2; 4
}
</pre></div>
<p>It will be refactored by plugin, so that required stable identifiers will be available for matching:</p>

<div>
<pre>val Xtr1 = Regex(&quot;^a.*&quot;)
// ...
str match {
  case Xtr1 &#x21d2; 1 // no binding
  // ...
}
</pre></div>
<p>It also works with partial function (see <a href="./src/test/scala/acolyte/ExtractorComponentSpec.scala#L159">more examples</a>).</p>

<div>
<pre>val partialFun: String &#x21d2; Int = {
  case ~(Regex(&quot;^a.*&quot;))                      &#x21d2; 1
  case ~(Regex(&quot;# ([A-Z]+).*&quot;), a)           &#x21d2; 2 
  case ~(Regex(&quot;([0-9]+);([a-z]+)&quot;), (a, b)) &#x21d2; 3
  case _                                     &#x21d2; 4
}
// Or def partialFun: String =&gt; Int = ...
</pre></div>
<p>It will be refactored as:</p>

<div>
<pre>val partialFun: String &#x21d2; Int = { str: String &#x21d2;
  val Xtr1 = Regex(&quot;^a.*&quot;)
  // ...
  str match {
    case Xtr1 &#x21d2; 1
    // ...
  }
}
</pre></div>
<p>Anonymous partial functions are refactored too (see <a href="./src/test/scala/acolyte/ExtractorComponentSpec.scala#L178">more examples</a>):</p>

<div>
<pre>def test(s: Option[String]): Option[Int] = s map {
  case ~(Regex(&quot;^a.*&quot;))                      &#x21d2; 1
  case ~(Regex(&quot;# ([A-Z]+).*&quot;), a)           &#x21d2; 2 
  case ~(Regex(&quot;([0-9]+);([a-z]+)&quot;), (a, b)) &#x21d2; 3
  case _                                     &#x21d2; 4
}
</pre></div></div>
<div class="section">
<h2>Usage<a name="Usage"></a></h2>

<blockquote>
<p>If you have another <tt>~</tt> symbol, it will have to be renamed at <tt>import pkg.{ ~ &#x21d2; renamed }</tt>.</p>
</blockquote>
<div class="section">
<h3>SBT usage<a name="SBT_usage"></a></h3>
<p>Scalac plugin can be used with SBT project, using its <a class="externalLink" href="http://www.scala-sbt.org/0.12.3/docs/Detailed-Topics/Compiler-Plugins.html">compiler plugins support</a>:</p>

<div>
<pre>autoCompilerPlugins := true

addCompilerPlugin(&quot;org.eu.acolyte&quot; %% &quot;scalac-plugin&quot; % &quot;VERSION&quot;)

scalacOptions += &quot;-P:acolyte:debug&quot; // Optional
</pre></div></div>
<div class="section">
<h3>Maven usage<a name="Maven_usage"></a></h3>
<p>Maven scala plugin <a class="externalLink" href="http://scala-tools.org/mvnsites/maven-scala-plugin/example_scalac_plugins.html">supports compiler plugin</a>, so you can do:</p>

<div>
<pre>
<span class="nt">&lt;project</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--</span><span class="c"> ... </span><span class="c">--&gt;</span>
  <span class="nt">&lt;build</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--</span><span class="c"> ... </span><span class="c">--&gt;</span>
    <span class="nt">&lt;plugings</span><span class="nt">&gt;</span>
      <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
        <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.scala-tools<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-scala-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="c">&lt;!--</span><span class="c"> ... version </span><span class="c">--&gt;</span>
        <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
          <span class="c">&lt;!--</span><span class="c"> ... </span><span class="c">--&gt;</span>
          <span class="nt">&lt;args</span><span class="nt">&gt;</span><span class="c">&lt;!--</span><span class="c"> Optional: enable debug </span><span class="c">--&gt;</span>
            <span class="nt">&lt;arg</span><span class="nt">&gt;</span>-P:acolyte:debug<span class="nt">&lt;/arg&gt;</span>
          <span class="nt">&lt;/args&gt;</span>

          <span class="nt">&lt;compilerPlugins</span><span class="nt">&gt;</span>
            <span class="nt">&lt;compilerPlugin</span><span class="nt">&gt;</span>
              <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.eu.acolyte<span class="nt">&lt;/groupId&gt;</span>
              <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>scalac-plugin_2.10<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;version</span><span class="nt">&gt;</span>VERSION<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;/compilerPlugin&gt;</span>
          <span class="nt">&lt;/compilerPlugins&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div></div></div>
<div class="section">
<h2>Plugin options<a name="Plugin_options"></a></h2>
<p>There is few option for this plugin.</p>

<ul>
  
<li><tt>-P:acolyte:debug</tt>: Display debug while compiling with (e.g. refactored match code).</li>
</ul></div>
<div class="section">
<h2>Compilation errors<a name="Compilation_errors"></a></h2>
<p>As match component refactors <tt>match</tt> AST when <tt>~(&#x2026;, &#x2026;)</tt> is used, then if there is compilation error around that location will be mentioned as <tt>/path/to/file.scala#refactored-match-M</tt> (with <tt>M</tt> informational index of refactored match).</p>
<p>If there is an error with given extractor factory, you will get something like:</p>

<div>
<pre>[error] /path/to/file.scala#refactored-match-M:1: Compilation error.
[error] Error details.
[error] val Xtr1 = B() // generated from ln L, col C
</pre></div>
<p>Comment <tt>// generated from ln L, col C</tt> indicates location in original code, before it gets refactored.</p>
<p>If there result from given extractor factory is not a valid extract, it will raise:</p>

<div>
<pre>[error] /path/to/file.scala#refactored-match-M:1: value Xtr0 is not a case class constructor, nor does it have an unapply/unapplySeq method
[error] case Xtr1((a @ _)) =&gt; Nil // generated from ln L, col C
</pre></div>
<p>When using <tt>~(Xtractor(params))</tt>, following error can be raised if <tt>unapply</tt> from <tt>Xtractor</tt> wait at least one argument.</p>

<div>
<pre>[error] /path/to/file.scala#refactored-match-M:1: not enough patterns for class Clazz offering Xtractor: expected 1, found 0
</pre></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2014.
          All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
